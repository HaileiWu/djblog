<style>
.tabs {float:left;width:160px;line-height:24px;}
.cont {float:left;width:140px;}
</style>
<script src="{{ MEDIA_URL }}editors/kindeditor/kindeditor-min.js"></script>
<script src="{{ MEDIA_URL }}editors/kindeditor/lang/zh_CN.js"></script>
<fieldset class="module aligned {{ fieldset.classes }}">
    {% if fieldset.name %}<h2>{{ fieldset.name }}</h2>{% endif %}
    {% if fieldset.description %}
        <div class="description">{{ fieldset.description|safe }}</div>
    {% endif %}
    {% for line in fieldset %}
        <div class="form-row{% if line.fields|length_is:'1' and line.errors %} errors{% endif %}{% for field in line %} {{ field.field.name }}{% endfor %}">
            {% if line.fields|length_is:'1' %}{{ line.errors }}{% endif %}
            {% for field in line %}
                <div{% if not line.fields|length_is:'1' %} class="field-box{% if not field.is_readonly and field.errors %} errors{% endif %}"{% endif %}>
                    {% if not line.fields|length_is:'1' and not field.is_readonly %}{{ field.errors }}{% endif %}
                    {% if field.is_checkbox %}
                        {{ field.field }}{{ field.label_tag }}
                    {% else %}
                        {{ field.label_tag }}
                        {% if field.is_readonly %}
                            <p>{{ field.contents }}</p>
                        {% else %}
							{% if field.field.html_name == 'content' %}
								<div>
									<textarea id="blog-content" name="content" class="vLargeTextField">{{ field.field.value|default_if_none:"" }}</textarea>
								</div>
								<script>
                  KindEditor.ready(function(K) {
                    var options = {
                      filterMode: false,
                      items: [
                        'justifyleft', 'justifycenter',
                        'justifyright', 'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent',
                         '|',  'fontname', 'fontsize', 'forecolor', 'hilitecolor', 'bold',
                        'italic', 'underline', 'strikethrough', '|', 'image', 'flash', 'table', 'hr', 
                        'emoticons', 'link', '|', 'source' 
                      ],
                      uploadJson: '/upload-image/',
                      extraFileUploadParams: {
                        csrfmiddlewaretoken: /value='([^']+)/.exec("{% csrf_token %}")[1]
                      },
                      minHeight: '400'
                    },  editor = K.create('#blog-content', options);
                    var $ = django.jQuery;

                    // hold
                    window.onbeforeunload = function(e){
                      e = e || window.event;
                      if (e){
                        e.returnValue = '放弃此次编辑？';
                      }
                      return '放弃此次编辑？';
                    }
                    $('#post_form').submit(function(){
                      //editor.sync();
                      window.onbeforeunload = null;
                    });
                  });
								</script>
							{% else %}
								{{ field.field }}
							{% endif %}
                        {% endif %}
                    {% endif %}
                    {% if field.field.help_text %}
                        <p class="help">{{ field.field.help_text|safe }}</p>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% endfor %}
</fieldset>
